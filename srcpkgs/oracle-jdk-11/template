# Template file for 'oracle-jdk-11'
pkgname=oracle-jdk-11
version=11.0.2
_longVersion=11.0.2+9
revision=1
_tag=f51449fcd52f4d52b93a989c5c56ed3c
short_desc="Java Development Kit (JDK)"
maintainer="Dominic Monroe <monroef4@googlemail.com>"
homepage="http://www.oracle.com/technetwork/java/javase/downloads/index.html"
license="oracle"
lib32disabled=yes
repository="nonfree"
only_for_archs="x86_64"
depends="hicolor-icon-theme desktop-file-utils xdg-utils shared-mime-info wget"
hostmakedepends="wget"
provides="java-environment-${version}_1"
_filename="jdk-11_linux-x64_bin.tar.gz"
distfiles="http://download.oracle.com/otn-pub/java/jdk/${version}/${_tag}/jdk-${version}_linux-x64_bin.tar.gz"
checksum="7b4fd8ffcf53e9ff699d964a80e4abf9706b5bdb5644a765c2b96f99e3a2cdc8"
wrksrc="jdk-$_shortVersion"

alternatives="
 java:/usr/bin/java:/usr/lib/jvm/jdk-${version}/bin/java
 java:/usr/bin/javaws:/usr/lib/jvm/jdk-${version}/bin/javaws
 java:/usr/bin/jcontrol:/usr/lib/jvm/jdk-${version}/bin/jcontrol
 java:/usr/bin/jjs:/usr/lib/jvm/jdk-${version}/bin/jjs
 java:/usr/bin/keytool:/usr/lib/jvm/jdk-${version}/bin/keytool
 java:/usr/bin/orbd:/usr/lib/jvm/jdk-${version}/bin/orbd
 java:/usr/bin/pack200:/usr/lib/jvm/jdk-${version}/bin/pack200
 java:/usr/bin/policytool:/usr/lib/jvm/jdk-${version}/bin/policytool
 java:/usr/bin/rmid:/usr/lib/jvm/jdk-${version}/bin/rmid
 java:/usr/bin/rmiregistry:/usr/lib/jvm/jdk-${version}/bin/rmiregistry
 java:/usr/bin/servertool:/usr/lib/jvm/jdk-${version}/bin/servertool
 java:/usr/bin/tnameserv:/usr/lib/jvm/jdk-${version}/bin/tnameserv
 java:/usr/bin/unpack200:/usr/lib/jvm/jdk-${version}/bin/unpack200

 jdk:/usr/bin/ControlPanel:/usr/lib/jvm/jdk-${version}/bin/ControlPanel
 jdk:/usr/bin/appletviewer:/usr/lib/jvm/jdk-${version}/bin/appletviewer
 jdk:/usr/bin/extcheck:/usr/lib/jvm/jdk-${version}/bin/extcheck
 jdk:/usr/bin/idlj:/usr/lib/jvm/jdk-${version}/bin/idlj
 jdk:/usr/bin/jar:/usr/lib/jvm/jdk-${version}/bin/jar
 jdk:/usr/bin/jarsigner:/usr/lib/jvm/jdk-${version}/bin/jarsigner
 jdk:/usr/bin/java-rmi.cgi:/usr/lib/jvm/jdk-${version}/bin/java-rmi.cgi
 jdk:/usr/bin/javac:/usr/lib/jvm/jdk-${version}/bin/javac
 jdk:/usr/bin/javadoc:/usr/lib/jvm/jdk-${version}/bin/javadoc
 jdk:/usr/bin/javafxpackager:/usr/lib/jvm/jdk-${version}/bin/javafxpackager
 jdk:/usr/bin/javah:/usr/lib/jvm/jdk-${version}/bin/javah
 jdk:/usr/bin/javap:/usr/lib/jvm/jdk-${version}/bin/javap
 jdk:/usr/bin/javapackager:/usr/lib/jvm/jdk-${version}/bin/javapackager
 jdk:/usr/bin/jcmd:/usr/lib/jvm/jdk-${version}/bin/jcmd
 jdk:/usr/bin/jconsole:/usr/lib/jvm/jdk-${version}/bin/jconsole
 jdk:/usr/bin/jdb:/usr/lib/jvm/jdk-${version}/bin/jdb
 jdk:/usr/bin/jdeps:/usr/lib/jvm/jdk-${version}/bin/jdeps
 jdk:/usr/bin/jhat:/usr/lib/jvm/jdk-${version}/bin/jhat
 jdk:/usr/bin/jinfo:/usr/lib/jvm/jdk-${version}/bin/jinfo
 jdk:/usr/bin/jmap:/usr/lib/jvm/jdk-${version}/bin/jmap
 jdk:/usr/bin/jmc:/usr/lib/jvm/jdk-${version}/bin/jmc
 jdk:/usr/bin/jmc.ini:/usr/lib/jvm/jdk-${version}/bin/jmc.ini
 jdk:/usr/bin/jps:/usr/lib/jvm/jdk-${version}/bin/jps
 jdk:/usr/bin/jrunscript:/usr/lib/jvm/jdk-${version}/bin/jrunscript
 jdk:/usr/bin/jsadebugd:/usr/lib/jvm/jdk-${version}/bin/jsadebugd
 jdk:/usr/bin/jstack:/usr/lib/jvm/jdk-${version}/bin/jstack
 jdk:/usr/bin/jstat:/usr/lib/jvm/jdk-${version}/bin/jstat
 jdk:/usr/bin/jstatd:/usr/lib/jvm/jdk-${version}/bin/jstatd
 jdk:/usr/bin/jvisualvm:/usr/lib/jvm/jdk-${version}/bin/jvisualvm
 jdk:/usr/bin/native2ascii:/usr/lib/jvm/jdk-${version}/bin/native2ascii
 jdk:/usr/bin/rmic:/usr/lib/jvm/jdk-${version}/bin/rmic
 jdk:/usr/bin/schemagen:/usr/lib/jvm/jdk-${version}/bin/schemagen
 jdk:/usr/bin/serialver:/usr/lib/jvm/jdk-${version}/bin/serialver
 jdk:/usr/bin/wsgen:/usr/lib/jvm/jdk-${version}/bin/wsgen
 jdk:/usr/bin/wsimport:/usr/lib/jvm/jdk-${version}/bin/wsimport
 jdk:/usr/bin/xjc:/usr/lib/jvm/jdk-${version}/bin/xjc

 java-plugin:/usr/lib/mozilla/plugins/libnpjp2.so:/usr/lib/jvm/jdk-${version}/jre/lib/$_arch/libnpjp2.so
"

do_fetch() {
	mkdir -p $wrksrc
	cd $wrksrc
	wget \
		--no-check-certificate \
		--header "Cookie: oraclelicense=accept-securebackup-cookie" \
		--progress=bar:force \
		-c -O $_filename \
		$distfiles
	echo "$checksum  $_filename" | sha256sum -c || { sha256sum "$_filename"; return 1; }
}

do_extract() {
	tar xf $_filename -C ..
}

do_build() {
	sed \
		-e "s|%LONG_VERSION%|${longVersion}|" \
		-e "s|%SHORT_VERSION%|${version}|" \
		-e "s|%ORACLE_JDK_URL%|${distfiles}|" \
		-e "s|%ORACLE_JDK_CHECKSUM%|${checksum}|" \
			${FILESDIR}/oracle-jdk-vars.sh.in > oracle-jdk-11-vars.sh
}

do_install() {
	vinstall oracle-jdk-11-vars.sh 644 "usr/lib/jvm/"

	vlicense legal/java.base/LICENSE

	# vinstall $FILESDIR/java-policy-settings.desktop 644 usr/share/applications
	ln -s jdk-${version} ${DESTDIR}/usr/lib/jvm/oracle-jdk

	# for i in 16 20 22 24 32 40 48 64 72 96 128 256 512; do
	# 	vinstall $FILESDIR/oracle-jdk-${i}x${i}.png 644 usr/share/icons/hicolor/${i}x${i}/apps oracle-java.png
	# done

	vinstall $FILESDIR/oracle-jdk.sh 644 "etc/profile.d" 11_oracle-jdk-11.sh
}
